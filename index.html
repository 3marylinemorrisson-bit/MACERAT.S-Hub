<!DOCTYPE html>
<html lang="fr" x-data>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MACERAT.S Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="icon" href="https://via.placeholder.com/32x32.png?text=M">
</head>
<body class="bg-white text-gray-800 font-sans">

  <!-- Header -->
  <header class="bg-gradient-to-r from-orange-500 via-green-500 to-blue-500 text-white shadow-lg">
    <div class="container mx-auto flex justify-between items-center p-6">
      <h1 class="text-2xl font-bold">MACERAT.S Hub</h1>
      <nav class="space-x-6 text-lg">
        <a href="#plateforme" class="hover:underline">Plateforme</a>
        <a href="#formations" class="hover:underline">Formations</a>
        <a href="#projets" class="hover:underline">Projets</a>
        <a href="#dashboard" class="hover:underline">Tableau de bord</a>
        <a href="#contact" class="hover:underline">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="bg-gray-100 py-20">
    <div class="container mx-auto text-center">
      <h2 class="text-4xl md:text-5xl font-bold mb-4 animate-fade-in">Formation, Architecture et Recherche</h2>
      <p class="text-lg md:text-xl mb-6 animate-fade-in delay-200">Plateforme ivoirienne dédiée à l’innovation urbaine et patrimoniale.</p>
      <a href="#plateforme" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold px-6 py-3 rounded-lg transition transform hover:scale-105">Découvrir la plateforme</a>
    </div>
  </section>

  <!-- Plateforme -->
  <section id="plateforme" class="py-20 container mx-auto" x-data="{ show: false }" x-intersect="show = true">
    <h3 class="text-3xl font-bold text-center mb-12" x-show="show" x-transition>La plateforme MACERAT.S</h3>
    <div class="grid md:grid-cols-3 gap-10">
      <template x-for="card in [
        {title:'Inscription Simplifiée', desc:'Rejoignez nos formations avec un tableau de bord intuitif et sécurisé.'},
        {title:'Gestion des Formations', desc:'Accédez à toutes nos ressources, suivez votre progression et explorez nos projets.'},
        {title:'Projets et Recherche', desc:'Découvrez nos projets urbains, architecturaux et patrimoniaux en cours.'}
      ]" :key="card.title">
        <div class="bg-white shadow-lg rounded-lg p-6 text-center transform transition hover:scale-105" x-show="show" x-transition>
          <h4 class="text-xl font-semibold mb-2" x-text="card.title"></h4>
          <p x-text="card.desc"></p>
        </div>
      </template>
    </div>
  </section>

  <!-- Formations dynamiques -->
  <section id="formations" class="bg-gray-50 py-20" x-data="{
    formations: [],
    async init() {
      try {
        const res = await fetch('https://ton-backend.onrender.com/formations');
        this.formations = await res.json();
      } catch(e) { console.error('Erreur fetch formations', e); }
    }
  }">
    <div class="container mx-auto text-center">
      <h3 class="text-3xl font-bold mb-12">Nos Formations</h3>
      <div class="grid md:grid-cols-3 gap-8">
        <template x-for="formation in formations" :key="formation.title">
          <div class="bg-white rounded-lg shadow p-6 hover:shadow-xl transition transform hover:scale-105">
            <h4 class="text-xl font-semibold mb-2" x-text="formation.title"></h4>
            <p x-text="formation.desc"></p>
            <button @click="enrollFormation(formation.id)" class="mt-3 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">S’inscrire</button>
          </div>
        </template>
      </div>
    </div>
  </section>

  <!-- Projets dynamiques -->
  <section id="projets" class="py-20 container mx-auto" x-data="{
    projets: [],
    async init() {
      try {
        const res = await fetch('https://ton-backend.onrender.com/projets');
        this.projets = await res.json();
      } catch(e) { console.error('Erreur fetch projets', e); }
    }
  }">
    <h3 class="text-3xl font-bold text-center mb-12">Projets en cours</h3>
    <div class="grid md:grid-cols-3 gap-8">
      <template x-for="projet in projets" :key="projet.title">
        <div class="bg-white rounded-lg shadow p-6 hover:shadow-2xl transition transform hover:scale-105">
          <h4 class="text-xl font-semibold mb-2" x-text="projet.title"></h4>
          <p x-text="projet.desc"></p>
        </div>
      </template>
    </div>
  </section>

  <!-- Tableau de bord avec login JWT -->
  <section id="dashboard" class="bg-gray-100 py-20" x-data="{
    loggedIn: false,
    user: '',
    password: '',
    token: '',
    async login() {
      if(this.user.trim() === '' || this.password.trim() === '') { alert('Remplissez tous les champs'); return; }
      try {
        const res = await fetch('https://ton-backend.onrender.com/login', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({email:this.user, password:this.password})
        });
        const data = await res.json();
        if(!res.ok){ alert(data.detail || 'Erreur login'); return; }
        this.token = data.token;
        localStorage.setItem('token', data.token);
        this.loggedIn = true;
      } catch(e){ console.error(e); alert('Erreur serveur'); }
    },
    async enrollFormation(formationId){
      if(!this.loggedIn){ alert('Connectez-vous pour vous inscrire'); return; }
      try {
        await fetch('https://ton-backend.onrender.com/enroll', {
          method:'POST',
          headers:{
            'Content-Type':'application/json',
            'Authorization': `Bearer ${this.token}`
          },
          body: JSON.stringify({user_email:this.user, formation_id:formationId})
        });
        alert('Inscription envoyée !');
      } catch(e){ console.error(e); alert('Erreur inscription'); }
    }
  }">
    <div class="container mx-auto text-center">
      <h3 class="text-3xl font-bold mb-6">Tableau de bord</h3>
      <template x-if="!loggedIn">
        <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow space-y-4">
          <input type="text" placeholder="Email" x-model="user" class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
          <input type="password" placeholder="Mot de passe" x-model="password" class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
          <button @click="login()" class="bg-green-500 hover:bg-green-600 text-white font-semibold px-6 py-3 rounded-lg transition">Se connecter</button>
        </div>
      </template>
      <template x-if="loggedIn">
        <div class="bg-white p-6 rounded-lg shadow max-w-lg mx-auto animate-fade-in">
          <h4 class="text-xl font-semibold mb-4">Bienvenue, <span x-text="user"></span> !</h4>
          <p>Vous pouvez maintenant vous inscrire aux formations directement depuis la liste ci-dessus.</p>
        </div>
      </template>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="bg-gray-50 py-20">
    <div class="container mx-auto text-center">
      <h3 class="text-3xl font-bold mb-8">Contactez-nous</h3>
      <p class="mb-6">Pour toute question ou demande d’inscription, remplissez le formulaire ci-dessous.</p>
      <form class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow space-y-4">
        <input type="text" placeholder="Nom complet" class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
        <input type="email" placeholder="Email" class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
        <textarea placeholder="Message" rows="4" class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500"></textarea>
        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-semibold px-6 py-3 rounded-lg transition">Envoyer</button>
      </form>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gradient-to-r from-orange-500 via-green-500 to-blue-500 text-white py-6 mt-10">
    <div class="container mx-auto text-center">
      <p>&copy; 2025 MACERAT.S Hub. Tous droits réservés.</p>
      <p>Suivez-nous sur 
        <a href="#" class="underline hover:text-gray-200">Facebook</a>, 
        <a href="#" class="underline hover:text-gray-200">Instagram</a>, 
        <a href="#" class="underline hover:text-gray-200">LinkedIn</a>
      </p>
    </div>
  </footer>

</body>
</html>
